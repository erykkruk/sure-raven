<%
  accounts_data = Current.family.accounts.manual.map do |acc|
    { id: acc.id, name: acc.name, currency: acc.currency }
  end
%>

<%= styled_form_with model: transfer, class: "space-y-4", data: {
      turbo_frame: "_top",
      controller: "transfer-form multi-currency-transfer",
      "multi-currency-transfer-accounts-value": accounts_data.to_json
    } do |f| %>
  <% if transfer.errors.present? %>
    <div class="text-destructive flex items-center gap-2">
      <%= icon "circle-alert", size: "sm" %>
      <p class="text-sm"><%= @transfer.errors.full_messages.to_sentence %></p>
    </div>
  <% end %>

  <section>
    <%= render "shared/transaction_type_tabs", active_tab: "transfer" %>
  </section>

  <section class="space-y-2">
    <%= f.collection_select :from_account_id, Current.family.accounts.manual.alphabetically, :id, :name,
                             { prompt: t(".select_account"), label: t(".from") },
                             required: true,
                             data: {
                               "multi-currency-transfer-target": "fromAccount",
                               action: "change->multi-currency-transfer#updateCurrencies"
                             } %>

    <%= f.collection_select :to_account_id, Current.family.accounts.manual.alphabetically, :id, :name,
                             { prompt: t(".select_account"), label: t(".to") },
                             required: true,
                             data: {
                               "multi-currency-transfer-target": "toAccount",
                               action: "change->multi-currency-transfer#updateCurrencies"
                             } %>

    <div class="space-y-2" data-multi-currency-transfer-target="currencyInfo">
      <div class="hidden flex items-center gap-2" data-multi-currency-transfer-target="sameCurrencyToggle">
        <%= f.check_box :same_currency,
                         checked: true,
                         data: {
                           "multi-currency-transfer-target": "sameCurrency",
                           action: "change->multi-currency-transfer#toggleCurrencyMode"
                         } %>
        <label for="transfer_same_currency" class="text-sm"><%= t(".same_currency") %></label>
      </div>

      <div>
        <%= f.number_field :amount_from,
                           label: t(".amount"),
                           required: true,
                           min: 0,
                           placeholder: "100",
                           step: 0.00000001,
                           data: { "multi-currency-transfer-target": "amountFrom" } %>
        <div class="text-xs text-secondary mt-1" data-multi-currency-transfer-target="fromCurrencyDisplay"></div>
      </div>

      <div class="hidden" data-multi-currency-transfer-target="amountToContainer">
        <%= f.number_field :amount_to,
                           label: t(".amount_to"),
                           min: 0,
                           placeholder: "100",
                           step: 0.00000001,
                           data: { "multi-currency-transfer-target": "amountTo" } %>
        <div class="text-xs text-secondary mt-1" data-multi-currency-transfer-target="toCurrencyDisplay"></div>
      </div>
    </div>

    <%= f.date_field :date, value: transfer.inflow_transaction&.entry&.date || Date.current, label: t(".date"), required: true, max: Date.current %>
  </section>

  <section>
    <%= f.submit t(".submit") %>
  </section>
<% end %>
